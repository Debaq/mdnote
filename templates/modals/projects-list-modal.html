<!-- Projects List Modal -->
<div class="legacy-modal" :class="{ 'active': $store.ui.modals.projectsList }" x-data="{
    projects: [],
    get hasProjects() {
        return this.projects && this.projects.length > 0;
    },
    loadProjects() {
        if (window.storageManager) {
            this.projects = window.storageManager.getProjectsList();
            console.log('Proyectos cargados:', this.projects);
        }
    },
    loadProject(projectId) {
        if ($store.project.loadProjectFromStorage(projectId)) {
            $store.ui.closeModal('projectsList');
            $store.ui.success($store.i18n.t('project.loaded'), '');
        } else {
            $store.ui.error('Error', $store.i18n.t('project.errors.loadFailed'));
        }
    },
    deleteProject(project) {
        if (confirm($store.i18n.t('project.confirmDelete', {name: project.title}))) {
            if (window.storageManager.delete(project.id)) {
                this.loadProjects();
                $store.ui.success($store.i18n.t('project.deleted'), '');
            }
        }
    },
    formatDate(dateStr) {
        return new Date(dateStr).toLocaleDateString();
    }
}" x-init="$watch('$store.ui.modals.projectsList', value => { if (value) loadProjects(); })">
    <div class="legacy-modal-content" style="max-width: 700px;">
        <div class="legacy-modal-header">
            <h2 x-text="$store.i18n.t('modals.projectsList.title')"></h2>
            <button class="btn-close" @click="$store.ui.closeModal('projectsList')">
                <i data-lucide="x" width="20" height="20"></i>
            </button>
        </div>
        <div class="modal-body">
            <template x-if="projects.length === 0">
                <div class="empty-state">
                    <i data-lucide="inbox" width="48" height="48"></i>
                    <p x-text="$store.i18n.t('modals.projectsList.noProjects')"></p>
                    <button class="btn-primary" @click="$store.ui.closeModal('projectsList'); $store.ui.openModal('newProject');" style="margin-top: 16px;" x-text="$store.i18n.t('project.createNew')">
                    </button>
                </div>
            </template>

            <template x-if="projects.length > 0">
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <template x-for="project in projects" :key="project.id">
                        <div style="display: flex; align-items: center; gap: 12px; padding: 16px; background: var(--bg-tertiary); border-radius: 8px; border: 1px solid var(--border);">
                            <div style="flex: 1;">
                                <div style="font-weight: 600; margin-bottom: 4px;" x-text="project.title"></div>
                                <div style="font-size: 13px; color: var(--text-secondary);">
                                    <span x-text="project.author || $store.i18n.t('project.noAuthor')"></span>
                                    <span x-show="project.genre"> â€¢ </span>
                                    <span x-text="project.genre"></span>
                                </div>
                                <div style="font-size: 12px; color: var(--text-tertiary); margin-top: 4px;">
                                    <span x-text="$store.i18n.t('common.modified') + ': '"></span><span x-text="formatDate(project.modified)"></span>
                                </div>
                            </div>
                            <button class="btn-primary" @click="loadProject(project.id)" style="padding: 8px 16px;" x-text="$store.i18n.t('common.open')">
                            </button>
                            <button class="btn-icon" @click="deleteProject(project)" :title="$store.i18n.t('common.delete')">
                                <i data-lucide="trash-2" width="18" height="18"></i>
                            </button>
                        </div>
                    </template>
                </div>
            </template>

            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border); display: flex; gap: 8px;">
                <button class="btn-secondary" @click="$store.ui.closeModal('projectsList'); $store.ui.openModal('newProject');" style="flex: 1;">
                    <i data-lucide="plus" width="16" height="16"></i>
                    <span x-text="$store.i18n.t('project.new')"></span>
                </button>
                <button class="btn-secondary" @click="$store.ui.closeModal('projectsList'); $store.ui.openModal('import');" style="flex: 1;">
                    <i data-lucide="upload" width="16" height="16"></i>
                    <span x-text="$store.i18n.t('common.import')"></span>
                </button>
            </div>
        </div>
    </div>
</div>