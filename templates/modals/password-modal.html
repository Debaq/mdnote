<!-- Password Modal -->
<div class="legacy-modal" :class="{ 'active': $store.ui.modals.password }">
    <div class="legacy-modal-content" style="max-width: 450px;">
        <div class="legacy-modal-header">
            <h2 x-text="$store.ui.modalData?.title || $store.i18n.t('modals.password.title')"></h2>
            <button class="btn-close" @click="$store.ui.closeModal('password'); if($store.ui.modalData?.onCancel) $store.ui.modalData.onCancel()">
                <i data-lucide="x" width="20" height="20"></i>
            </button>
        </div>
        <div class="modal-body">
            <p x-text="$store.ui.modalData?.message || $store.i18n.t('modals.password.message')" style="margin-bottom: 16px;">
            </p>

            <form @submit.prevent="
                const password = $el.querySelector('[name=password]').value;
                if (!password) {
                    $store.ui.error('Error', $store.i18n.t('modals.password.errors.empty'));
                    return;
                }
                if($store.ui.modalData?.onSubmit) {
                    $store.ui.modalData.onSubmit(password);
                    $store.ui.closeModal('password');
                }
                $el.reset();
            ">
                <div class="form-group">
                    <label x-text="$store.i18n.t('modals.password.password')"></label>
                    <input
                        type="password"
                        name="password"
                        required
                        :placeholder="$store.i18n.t('modals.password.passwordPlaceholder')"
                        autofocus
                        style="width: 100%;"
                    >
                </div>

                <template x-if="$store.ui.modalData?.showEncryptionOptions">
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="encryptProject">
                            <span x-text="$store.i18n.t('modals.password.encryptAll')"></span>
                        </label>
                        <p class="hint" x-text="$store.i18n.t('modals.password.encryptAllHint')"></p>
                    </div>
                </template>

                <template x-if="$store.ui.modalData?.showRememberOption">
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="rememberPassword">
                            <span x-text="$store.i18n.t('modals.password.rememberSession')"></span>
                        </label>
                        <p class="hint" x-text="$store.i18n.t('modals.password.rememberSessionHint')"></p>
                    </div>
                </template>

                <div class="modal-footer" style="margin-top: 24px;">
                    <button
                        type="button"
                        class="btn-secondary"
                        @click="$store.ui.closeModal('password'); if($store.ui.modalData?.onCancel) $store.ui.modalData.onCancel()"
                        x-text="$store.i18n.t('common.cancel')"
                    >
                    </button>
                    <button type="submit" class="btn-primary">
                        <i data-lucide="lock" width="16" height="16"></i>
                        <span x-text="$store.ui.modalData?.submitText || $store.i18n.t('modals.password.decrypt')"></span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
